# ガイド機能/チュートリアル 仕様書

## 概要

ボタンやアクションの説明をUIで提供し、初心者でも直感的にゲームを理解できるようにします。
アクションが実行できない理由や、各アクションの意味を明確に説明します。

## 目的

- 初心者のオンボーディング体験向上
- ゲームルールの理解促進
- ユーザビリティの向上
- エラー時の混乱防止

## 機能要件

### 1. ツールチップ（Tooltip）機能

#### 1.1 常時表示型ツールチップ

ボタンやUI要素にホバー時に説明を表示

**対象要素:**

- **ヒット (Hit)**: 「カードを1枚追加します」
- **スタンド (Stand)**: 「現在の手札で勝負します」
- **ダブルダウン (Double Down)**: 「ベット額を2倍にして、カードを1枚だけ追加します」
- **スプリット (Split)**: 「同じ数字のカード2枚を2つの手札に分けます」
- **サレンダー (Surrender)**: 「ベット額の半分を払って降りられます（利用可能な場合）」
- **ベットエリア**: 「ベット額を選択してください」
- **ディール (Deal)**: 「ゲームを開始します」

#### 1.2 無効化状態の説明

アクションが実行できない時の理由表示

**例:**

- ヒット無効時: 「21を超えているため、これ以上カードを引けません」
- ダブルダウン無効時: 「最初の2枚のカードでのみ使用できます」
- スプリット無効時: 「同じ数字のカードが2枚必要です」
- ディール無効時: 「ベット額を選択してください」
- ベット変更不可時: 「ゲーム中はベット額を変更できません」

### 2. チュートリアルモード

#### 2.1 初回プレイ時の自動起動

- 初回訪問時（localStorage確認）
- スキップ可能
- 「今後表示しない」オプション

#### 2.2 チュートリアルステップ

**Step 1: ゲーム画面の説明**

```
ハイライト: 全体レイアウト
説明: 「ブラックジャックへようこそ！画面の見方を説明します」
- ディーラーの手札エリア
- プレイヤーの手札エリア
- ベットエリア
- アクションボタン
- 所持金表示
```

**Step 2: ベットの説明**

```
ハイライト: ベットエリア
説明: 「まずベット額を選択します」
- チップをクリックして金額を選ぶ
- ベット額は所持金の範囲内で設定
- Dealボタンでゲーム開始
```

**Step 3: ゲームの流れ**

```
ハイライト: カードエリア
説明: 「カードが配られます」
- プレイヤーに2枚
- ディーラーに2枚（1枚は伏せた状態）
- 目標は21に近づけること
```

**Step 4: アクションの説明**

```
ハイライト: アクションボタン
説明: 「選択できるアクション」
- Hit: カードを追加
- Stand: 現在の手札で勝負
- その他の特殊アクション
```

**Step 5: 勝敗判定**

```
説明: 「勝敗の決まり方」
- 21に近い方が勝ち
- 21を超えると負け（バースト）
- ディーラーは17以上まで引く
```

#### 2.3 チュートリアル再表示

- 設定メニューから「チュートリアルを見る」
- ヘルプボタンからアクセス

### 3. コンテキストヘルプ

#### 3.1 状況に応じたヒント表示

ゲーム進行状況に応じて適切なヒントを表示

**表示タイミング:**

- ベット選択時: 「適切なベット額を選びましょう」
- 手札合計が近い時: 「もう少しで21です。慎重に選択しましょう」
- バースト寸前: 「注意：次のカードで21を超える可能性があります」
- ディーラーが強い時: 「ディーラーの見えているカードは○です」

#### 3.2 ゲーム用語集

モーダルまたはサイドパネルで用語を解説

**主な用語:**

- ブラックジャック: A + 絵札/10 の組み合わせ
- バースト: 21を超えること
- プッシュ: 引き分け
- ナチュラル: 最初の2枚で21
- ハウスルール: ディーラーの行動規則

### 4. ビジュアルガイド

#### 4.1 アニメーション付きガイド

- 初回ベット時にチップエリアを軽くパルス
- 実行可能なボタンを強調表示
- 次に取るべきアクションを示唆

#### 4.2 カラーコーディング

- 実行可能: 緑/通常色
- 実行不可: グレーアウト
- 推奨アクション: 軽いハイライト（オプション）

### 5. ヘルプセンター

#### 5.1 ヘルプボタン

- 画面右上または左上に配置
- クリックでヘルプモーダル表示

#### 5.2 ヘルプモーダル内容

**セクション構成:**

1. ゲームの基本ルール
2. 各アクションの説明
3. 勝敗の決まり方
4. よくある質問（FAQ）
5. 用語集

## データ構造

### localStorageキー

```javascript
{
  "blackjack_tutorial": {
    "completed": false,           // チュートリアル完了フラグ
    "dontShowAgain": false,       // 今後表示しないフラグ
    "currentStep": 0,             // 現在のステップ
    "lastShown": "2025-10-20T10:00:00Z"
  },
  "blackjack_hints": {
    "showTooltips": true,         // ツールチップ表示設定
    "showContextHelp": true,      // コンテキストヘルプ表示設定
    "hintLevel": "beginner"       // beginner/intermediate/expert
  }
}
```

## UI/UX仕様

### ツールチップデザイン

```css
.tooltip {
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 14px;
  max-width: 200px;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}
```

### チュートリアルオーバーレイ

```css
.tutorial-overlay {
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(2px);
}

.tutorial-spotlight {
  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
  border-radius: 8px;
  position: relative;
  z-index: 999;
}
```

### ヘルプモーダル

- 半透明の背景オーバーレイ
- 中央配置
- スクロール可能なコンテンツ
- 閉じるボタン（×）
- ESCキーで閉じる

## アクセシビリティ

### キーボード操作

- `Tab`: 次の要素へ
- `Shift + Tab`: 前の要素へ
- `Enter/Space`: ボタン実行
- `Esc`: モーダルを閉じる
- `?`: ヘルプを開く

### スクリーンリーダー対応

- `aria-label`: ボタンの説明
- `aria-disabled`: 無効状態の明示
- `aria-describedby`: ツールチップとの関連付け
- `role="tooltip"`: ツールチップの役割明示

## 実装順序

### Phase 1: ツールチップ基盤

1. ツールチップコンポーネント作成
2. 各ボタンへの説明文追加
3. ホバー時の表示/非表示ロジック
4. 無効化状態の説明文実装

### Phase 2: チュートリアルモード

1. チュートリアルステップ定義
2. オーバーレイとスポットライト実装
3. ステップナビゲーション（次へ/戻る）
4. localStorage連携

### Phase 3: ヘルプセンター

1. ヘルプボタン追加
2. ヘルプモーダル作成
3. コンテンツ作成（ルール、FAQ等）
4. 検索機能（オプション）

### Phase 4: コンテキストヘルプ

1. ゲーム状態に応じたヒント生成ロジック
2. ヒント表示エリア実装
3. タイミング調整

### Phase 5: 設定と調整

1. ガイド機能のON/OFF設定
2. デザイン調整
3. アニメーション追加
4. テストとバグ修正

## テストケース

### ツールチップ

- [ ] ホバー時に正しい説明が表示される
- [ ] 無効ボタンで理由が表示される
- [ ] モバイルでタップ時に表示される
- [ ] 複数のツールチップが重ならない

### チュートリアル

- [ ] 初回訪問時に自動起動
- [ ] 各ステップが正しく表示される
- [ ] スキップ機能が動作する
- [ ] 「今後表示しない」が機能する
- [ ] 再表示ボタンが動作する

### ヘルプセンター

- [ ] モーダルが正しく開閉する
- [ ] コンテンツが読みやすい
- [ ] スクロールが機能する
- [ ] ESCキーで閉じる

### アクセシビリティ

- [ ] キーボード操作が可能
- [ ] スクリーンリーダーで読み上げ可能
- [ ] フォーカス管理が適切

## 将来の拡張可能性

- インタラクティブなミニゲーム形式のチュートリアル
- 動画チュートリアル
- 多言語対応
- ゲーム戦略のアドバイス機能
- プレイヤーのスキルレベルに応じた動的ヒント
